# Analysis of captured stream of working Windows driver

Following flow is captured with Wireshark on Windows host with stock Windows driver from FrescoLogic:
1. USB-HDMI dongle with FL2000 and IT66121 connected to PC
2. HDMI display with 800x480 resolution connected
3. Display disconnected
4. Dongle disconnected

Dump of correctly working windows driver with non-standard HDMI display is [available on Dropbox](https://www.dropbox.com/s/niizuk2d4xrkcmg/fl2000.pcapng?dl=0) (45MB pcapng). Use filter below to filter our only FL2000 transactions:<br>
`(usb.addr == "1.4.0" || usb.addr == "1.4.1" || usb.addr == "1.4.2" || usb.addr == "1.4.3")`

NOTE: by default USBPcap captures 65535 bytes max, so packets with frame data are incomplete. For details see https://github.com/desowin/usbpcap/issues/26

## Using Wireshark dissector

To start Wireshark dissector please use following command:<br>
`wireshark -X lua_script:fl2k.lua -r fl2000.pcapng`

NOTE: for correct dissector operation Wireshark must be built with patch allowing dissection of CONTROL messages with "device" recipient. For details see https://code.wireshark.org/review/32626 (merged to Wireshark master development branch)

## Known issues

1. Empty 'status' stage CONTROL packets and zero-size BULK packets are not dissected because of Wireshark implementation - see `dissect_usb_payload()` function not proceeding to dissection when there is no data beyond standard USB header

## Observations

See parsed stream dump and register access statistics below

* All video frames are transmitted in RGB24 which is confirmed by USB data frame size:<br>
800x480 (resolution) x3 (bytes per pixel) = 1152000
* EO frame signaled by zero-sized BULK packet
* First BULK frame has timestamp of 40.036560, last BULK packet has timestamp 50.371687, with total 681 ob non-zero BULK frames transmitted - this give us 65.9 FPS which seem to be a strange number.
* Display connect occur on sequence 1530
  * receive interrupt (1) with status 0x680000E1
    - External monitor event: external monitor connected
* Display disconnect occur on sequence 8830
  * receive interrupt (1) with status 0x480AA260
    - External monitor event: external monitor disconnected
* Something happens starting sequence 8533 - driver stops forcing VGA connect and receives corresponding interrupt from EDID VGA detection circuitry. This does not seem to be correct because we use HDMI monitor, not VGA
  * set bit 25 in register 0x803C (0xD701084D -> 0xD501084D): Force VGA Connect
  * receive interrupt (1) with status 0xA8087EE1
    - EDID event: VGA monitor disconnected
* VGA connect status and VGA DAC power up status correctly follow connection status
* No errors observed during operation except LBUF overflow - but probably this is due too high FPS (66 vs expected 30)
* It is interesting to note that on disconnect amount of frames transmitted is 680 which is 1 less than BULK frames on USB bus - probably disconnect circuitry took some time to raise interrupt so 1 extra frame got transmitted and lost
* There are at least 2 times when (seemingly) concurrent access to registers happened leading to some sort of mixup:
  * Setting PLL configuration and application reset
  * Configuring TD and starting IT66121 I2C register access
* There are 2 extra application resets besides the one on the start of the driver
* In EDID section, it is seen how driver workarounds the problem of missing 3 first bytes of every EDID read operation: Ask for 6 bytes that will overlap the missing 3 bytes for every 32-bytes read. This leads to 7 read blocks while this could be brought done by 5 only significantly amount of activities:
  * Fill 1st 3 bytes with 00 FF FF
  * Read 32 bytes from offset 0
  * Read 32 bytes from offset 29
  * Read 32 bytes from offset 58
  * Read 32 bytes from offset 87
  * Read 12 bytes from offset 116

## Register access statistics

**FL2000**

```
0x0070	10	10
0x0078	4	4
0x8000	8	0
0x8004	4	4
0x8008	2	2
0x800C	2	2
0x8010	2	2
0x8014	2	2
0x801C	2	2
0x8020	1926	836
0x8024	568	0
0x8028	0	264
0x802C	2	2
0x803C	14	14
0x8048	6	6
0x8088	2	2
```
**IT66121**
```
0x00	1	0
0x04	17	9
0x08	2	1
0x0C	22	19
0x10	29	22
0x14	147	29
0x30	4	4
0x34	2	2
0x58	1	2
0x5C	0	1
0x60	14	10
0x64	7	5
0x68	9	5
0x6C	3	2
0x70	4	2
0x90	0	1
0x94	1	1
0x98	3	3
0xC0	5	3
0xC4	4	3
0xCC	2	2
0xE0	2	2
0xE4	1	1
0xF8	3	3
```

## Parsed stream

NOTE: when reading the stream, one need to remember that byte access is not possible for I2C connected devices, always dword (4 bytes) is read; thus addresses are always 4-byte aligned.

RST_CTRL_REG: Software reset to application logic
```
REG RD 0x8048 : 0x00000004
REG WR 0x8048 : 0x00008004
```
Check connected IT66121 chip ID and revision
```
I2C RD IT66121: 0x00 : 0x16124954
```
0x04: SW Reset
```
I2C RD IT66121: 0x04 : 0x0000601C
I2C RD IT66121: 0x04 : 0x0000601C
I2C WR IT66121: 0x04 : 0x0000603C
```
0x0F: power down IACLK, TxCLK
```
I2C RD IT66121: 0x0C : 0x080C0000
I2C RD IT66121: 0x0C : 0x080C0000
I2C WR IT66121: 0x0C : 0x380C0000
```
???
```
I2C RD IT66121: 0x04 : 0x0000601C
I2C RD IT66121: 0x04 : 0x0000601C
I2C WR IT66121: 0x04 : 0x0000601C
```
???
```
I2C RD IT66121: 0x60 : 0x188810FF
I2C RD IT66121: 0x60 : 0x188810FF
I2C WR IT66121: 0x60 : 0x188810FF
```
???
```
I2C RD IT66121: 0x60 : 0x188810FF
I2C RD IT66121: 0x60 : 0x188810FF
I2C WR IT66121: 0x60 : 0x188810FF
```
???
```
I2C RD IT66121: 0x64 : 0x00000094
I2C RD IT66121: 0x64 : 0x00000094
I2C WR IT66121: 0x64 : 0x00000094
```
0x61: Disable reset for HDMI_TX_DRV
```
I2C RD IT66121: 0x60 : 0x188810FF
I2C RD IT66121: 0x60 : 0x188810FF
I2C WR IT66121: 0x60 : 0x188800FF
```
???
```
I2C RD IT66121: 0x60 : 0x188800FF
I2C RD IT66121: 0x60 : 0x188800FF
I2C WR IT66121: 0x60 : 0x188800FF
```
???
```
I2C RD IT66121: 0x64 : 0x00000094
I2C RD IT66121: 0x64 : 0x00000094
I2C WR IT66121: 0x64 : 0x00000094
```
0x70: YUV422, 1/2 TXCLK, CCIR656
```
I2C RD IT66121: 0x68 : 0xFF003000
I2C WR IT66121: 0x68 : 0xFF703000
```
0x66: 00->1F ???
```
I2C RD IT66121: 0x64 : 0x00000094
I2C WR IT66121: 0x64 : 0x001F0094
```
0x63: 18->38 ???
```
I2C RD IT66121: 0x60 : 0x188800FF
I2C WR IT66121: 0x60 : 0x388800FF
```
0x0F: power up IACLK, TxCLK
```
I2C RD IT66121: 0x0C : 0x380C0000
I2C RD IT66121: 0x0C : 0x380C0000
I2C WR IT66121: 0x0C : 0x080C0000
```
SW Reset
```
I2C RD IT66121: 0x04 : 0x0000601C
I2C RD IT66121: 0x04 : 0x0000601C
I2C WR IT66121: 0x04 : 0x0000603C
```
RST_CTRL_REG: Software reset to application logic
```
REG RD 0x8048 : 0x00000004
REG WR 0x8048 : 0x00008004
```
VGA_I2C_SC_REG: VGA EDID detect enable
```
REG RD 0x8020 : 0x8000044C
REG WR 0x8020 : 0xC000044C
```
VGA_I2C_SC_REG: VGA External monitor detect enable
```
REG RD 0x8020 : 0xC000044C
REG WR 0x8020 : 0xD000044C
```
VGA Control Register3: Disable an auto-generation of reset when we wakeup from disconnect
```
REG RD 0x8088 : 0x00000488
REG WR 0x8088 : 0x00000088
```
Just in case - check interrupt status register
```
REG RD 0x8000 : 0x08000000
```
**Monitor connected**
```
INTERRUPT	1
REG RD 0x8000 : 0x680000E1
```
**'Enable' sequence for USB interface**
```
REG RD 0x0070 : 0x04006085
REG WR 0x0070 : 0x04106085
```
```
REG RD 0x0070 : 0x04106085
REG WR 0x0070 : 0x04186085
```
```
REG RD 0x0078 : 0x18010D14
REG WR 0x0078 : 0x18010D14
```
**Read monitor EDID data**

Pattern here is: `rrw10-rw14-rrw10-rw14-rw14-w10-w14`<br>
0x04-0x07: read default values
```
I2C RD IT66121: 0x04 : 0x0000601C
```
0x10: Switch DDC port to PC
```
I2C RD IT66121: 0x10 : 0x633FD796
I2C WR IT66121: 0x10 : 0x633FD701
```
0x15: Clear DDC FIFO
```
I2C RD IT66121: 0x14 : 0xBE82F7F3
I2C WR IT66121: 0x14 : 0xBE8209F3
```
0x0F: Power UP CRCLK
```
I2C RD IT66121: 0x0C : 0x086C0000
I2C WR IT66121: 0x0C : 0x006C0000
```
Block 1
```
I2C RD IT66121: 0x10 : 0x633FD791
I2C RD IT66121: 0x10 : 0x633FD791
I2C WR IT66121: 0x10 : 0x633FD793
```
```
I2C RD IT66121: 0x14 : 0xBE82F9F3
I2C WR IT66121: 0x14 : 0xBE820FF3
```
```
I2C RD IT66121: 0x10 : 0x633FD793
I2C RD IT66121: 0x10 : 0x633FD793
I2C WR IT66121: 0x10 : 0x633FD793
```
```
I2C RD IT66121: 0x14 : 0xD982FFF3
I2C WR IT66121: 0x14 : 0xD9820FF3
```
```
I2C RD IT66121: 0x14 : 0xFF82FFF3
I2C WR IT66121: 0x14 : 0xFF8209F3
```
```
I2C WR IT66121: 0x10 : 0x2000A001
```
```
I2C WR IT66121: 0x14 : 0x20000300
```
```
I2C RD IT66121: 0x14 : 0xFF80F300
I2C RD IT66121: 0x14 : 0xFF80F300
I2C RD IT66121: 0x14 : 0xFF80F300
I2C RD IT66121: 0x14 : 0xFF80F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0480F300
I2C RD IT66121: 0x14 : 0x8180F300
I2C RD IT66121: 0x14 : 0x0480F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x1180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0380F300
I2C RD IT66121: 0x14 : 0x8080F300
I2C RD IT66121: 0x14 : 0x0F80F300
I2C RD IT66121: 0x14 : 0x0A80F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0A80F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
```
Block 2
```
I2C RD IT66121: 0x10 : 0x2000A091
I2C RD IT66121: 0x10 : 0x2000A091
I2C WR IT66121: 0x10 : 0x2000A093
```
```
I2C RD IT66121: 0x14 : 0x0080F300
I2C WR IT66121: 0x14 : 0x00800F00
```
```
I2C RD IT66121: 0x10 : 0x2000A093
I2C RD IT66121: 0x10 : 0x2000A093
I2C WR IT66121: 0x10 : 0x2000A093
```
```
I2C RD IT66121: 0x14 : 0x0082FF00
I2C WR IT66121: 0x14 : 0x00820F00
```
```
I2C RD IT66121: 0x14 : 0x0082FF00
I2C WR IT66121: 0x14 : 0x00820900
```
```
I2C WR IT66121: 0x10 : 0x061DA001
```
```
I2C WR IT66121: 0x14 : 0x061D0300
```
```
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
```
Block 3
```
I2C RD IT66121: 0x10 : 0x061DA091
I2C RD IT66121: 0x10 : 0x061DA091
I2C WR IT66121: 0x10 : 0x061DA093
```
```
I2C RD IT66121: 0x14 : 0xFF80F300
I2C WR IT66121: 0x14 : 0xFF800F00
```
```
I2C RD IT66121: 0x10 : 0x061DA093
I2C RD IT66121: 0x10 : 0x061DA093
I2C WR IT66121: 0x10 : 0x061DA093
```
```
I2C RD IT66121: 0x14 : 0x0482FF00
I2C WR IT66121: 0x14 : 0x04820F00
```
```
I2C RD IT66121: 0x14 : 0x0082FF00
I2C WR IT66121: 0x14 : 0x00820900
```
```
I2C WR IT66121: 0x10 : 0x2020A001
```
```
I2C WR IT66121: 0x14 : 0x20200300
```
```
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x0180F300
I2C RD IT66121: 0x14 : 0x8080F300
I2C RD IT66121: 0x14 : 0x0C80F300
I2C RD IT66121: 0x14 : 0x2080F300
I2C RD IT66121: 0x14 : 0x8080F300
I2C RD IT66121: 0x14 : 0x3080F300
I2C RD IT66121: 0x14 : 0xE080F300
I2C RD IT66121: 0x14 : 0x2D80F300
I2C RD IT66121: 0x14 : 0x1080F300
I2C RD IT66121: 0x14 : 0x2880F300
I2C RD IT66121: 0x14 : 0x3080F300
```
Block 4
```
I2C RD IT66121: 0x10 : 0x2020A091
I2C RD IT66121: 0x10 : 0x2020A091
I2C WR IT66121: 0x10 : 0x2020A093
```
```
I2C RD IT66121: 0x14 : 0x3080F300
I2C WR IT66121: 0x14 : 0x30800F00
```
```
I2C RD IT66121: 0x10 : 0x2020A093
I2C RD IT66121: 0x10 : 0x2020A093
I2C WR IT66121: 0x10 : 0x2020A093
```
```
I2C RD IT66121: 0x14 : 0x3082FF00
I2C WR IT66121: 0x14 : 0x30820F00
```
```
I2C RD IT66121: 0x14 : 0x3082FF00
I2C WR IT66121: 0x14 : 0x30820900
```
```
I2C WR IT66121: 0x10 : 0x063DA001
```
```
I2C WR IT66121: 0x14 : 0x063D0300
```
```
I2C RD IT66121: 0x14 : 0xD380F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x6C80F300
```
Block 5
```
I2C RD IT66121: 0x10 : 0x063DA091
I2C RD IT66121: 0x10 : 0x063DA091
I2C WR IT66121: 0x10 : 0x063DA093
```
```
I2C RD IT66121: 0x14 : 0x0180F300
I2C WR IT66121: 0x14 : 0x01800F00
```
```
I2C RD IT66121: 0x10 : 0x063DA093
I2C RD IT66121: 0x10 : 0x063DA093
I2C WR IT66121: 0x10 : 0x063DA093
```
```
I2C RD IT66121: 0x14 : 0x0182FF00
I2C WR IT66121: 0x14 : 0x01820F00
```
```
I2C RD IT66121: 0x14 : 0x0182FF00
I2C WR IT66121: 0x14 : 0x01820900
```
```
I2C WR IT66121: 0x10 : 0x2040A001
```
```
I2C WR IT66121: 0x14 : 0x20400300
```
```
I2C RD IT66121: 0x14 : 0x4480F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x1880F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x1080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x1080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
```
Block 6
```
I2C RD IT66121: 0x10 : 0x2040A091
I2C RD IT66121: 0x10 : 0x2040A091
I2C WR IT66121: 0x10 : 0x2040A093
```
```
I2C RD IT66121: 0x14 : 0x0080F300
I2C WR IT66121: 0x14 : 0x00800F00
```
```
I2C RD IT66121: 0x10 : 0x2040A093
I2C RD IT66121: 0x10 : 0x2040A093
I2C WR IT66121: 0x10 : 0x2040A093
```
```
I2C RD IT66121: 0x14 : 0x0082FF00
I2C WR IT66121: 0x14 : 0x00820F00
```
```
I2C RD IT66121: 0x14 : 0x0082FF00
I2C WR IT66121: 0x14 : 0x00820900
```
```
I2C WR IT66121: 0x10 : 0x065DA001
```
```
I2C WR IT66121: 0x14 : 0x065D0300
```
```
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
```
Block 7
```
I2C RD IT66121: 0x10 : 0x065DA091
I2C RD IT66121: 0x10 : 0x065DA091
I2C WR IT66121: 0x10 : 0x065DA093
```
```
I2C RD IT66121: 0x14 : 0x0080F300
I2C WR IT66121: 0x14 : 0x00800F00
```
```
I2C RD IT66121: 0x10 : 0x065DA093
I2C RD IT66121: 0x10 : 0x065DA093
I2C WR IT66121: 0x10 : 0x065DA093
```
```
I2C RD IT66121: 0x14 : 0x0082FF00
I2C WR IT66121: 0x14 : 0x00820F00
```
```
I2C RD IT66121: 0x14 : 0x0082FF00
I2C WR IT66121: 0x14 : 0x00820900
```
```
I2C WR IT66121: 0x10 : 0x2060A001
```
```
I2C WR IT66121: 0x14 : 0x20600300
```
```
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x1080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x0080F300
I2C RD IT66121: 0x14 : 0x1780F300
```
**Configure FL2000 for streaming**

VGA_CTRL_REG_ACLK: Force PLL power UP always
```
REG RD 0x803C : 0xE001084D
REG WR 0x803C : 0xE401084D
```
<u>Mixup</u><br>
VGA_PLL_REG: configure PLL parameters<br>
RST_CTRL_REG: Software reset to application logic
```
REG WR 0x802C : 0x0020410A
REG RD 0x8048 : 0x00000004
REG WR 0x8048 : 0x00008004
REG RD 0x802C : 0x0020410A
```
VGA_CTRL_REG_ACLK: Do not use packet pending
```
REG RD 0x803C : 0xE401084D
REG WR 0x803C : 0xC401084D
```
VGA_CTRL_REG_ACLK: Use zero-length packet, VGA error interrupt enable
```
REG RD 0x803C : 0xC401084D
REG WR 0x803C : 0xD501084D
```
VGA_CTRL_REG_PXCLK: Disable DAC output, disable continuous drop count
```
REG RD 0x8004 : 0x0010239C
REG WR 0x8004 : 0x0010031C
```
VGA_CTRL_REG_PXCLK: Enable DAC output, Clear watermark
```
REG RD 0x8004 : 0x0010031C
REG WR 0x8004 : 0x0010039D
```
VGA_HSYNC_REG1: value
```
REG WR 0x8008 : 0x032003A0
REG RD 0x8008 : 0x032003A0
```
VGA_HSYNC_REG2: value
```
REG WR 0x800C : 0x00300059
REG RD 0x800C : 0x00300059
```
VGA_VSYNC_REG1: value
```
REG WR 0x8010 : 0x01E0020D
REG RD 0x8010 : 0x01E0020D
```
VGA_VSYNC_REG2: value
```
REG WR 0x8014 : 0x02130021
REG RD 0x8014 : 0x02130021
```
VGA_ISOCH_REG: reset mframe_count to 0
```
REG RD 0x801C : 0x00850000
REG WR 0x801C : 0x00000000
```
(???)
```
REG RD 0x0070 : 0x04186085
REG WR 0x0070 : 0x04186085
```
<u>Mixup</u><br>
VGA_CTRL_REG_ACLK: Force VGA connect<br>
I2C RD IT66121: 0x0C : 0x006C0000
```
REG RD 0x8020 : 0xC00014CC
REG RD 0x803C : 0xD501084D
REG WR 0x8020 : 0x50000CCC
REG WR 0x803C : 0xD701084D
REG RD 0x8020 : 0x40000CCC
REG RD 0x8020 : 0xC0000CCC
REG RD 0x8024 : 0x006C0000
```
**Configure IT66121 for streaming**

???
```
I2C WR IT66121: 0x0C : 0x006C0000
```
???
```
I2C RD IT66121: 0xC0 : 0x089A8102
I2C RD IT66121: 0xC0 : 0x089A8102
I2C WR IT66121: 0xC0 : 0x089A8102
```
0xC6: enable General Control Packet, Repeat General Control Packet
```
I2C RD IT66121: 0xC4 : 0xFF0004C0
I2C WR IT66121: 0xC4 : 0xFF0304C0
```
0x0F: Bank 1
```
I2C RD IT66121: 0x0C : 0x006C0000
I2C WR IT66121: 0x0C : 0x016C0000
```
0x158-0x15B
```
I2C WR IT66121: 0x58 : 0x00005810
```
0x15C-0x15F
```
I2C WR IT66121: 0x5C : 0x00000700
```
0x160-0x163
```
I2C WR IT66121: 0x60 : 0x00000000
```
0x164-0x167
```
I2C WR IT66121: 0x64 : 0x00000000
```
0x0F: Bank 0
```
I2C RD IT66121: 0x0C : 0x016C0000
I2C WR IT66121: 0x0C : 0x006C0000
```
0xCD: Enable AVI InfoFrame, Repeat AVI Infoframe
```
I2C RD IT66121: 0xCC : 0xFF0000FF
I2C WR IT66121: 0xCC : 0xFF0003FF
```
0x04: set HDCP reset, clear Audio FIFO reset, clear SW Audio base clock reset
```
I2C RD IT66121: 0x04 : 0x0000601C
I2C WR IT66121: 0x04 : 0x00006009
```
0x70: Input PCLK delay = 01
```
I2C RD IT66121: 0x70 : 0x10000800
I2C RD IT66121: 0x70 : 0x10000800
I2C WR IT66121: 0x70 : 0x10000801
```
0x0F: Power Down TxCLK
```
I2C RD IT66121: 0x0C : 0x006C0000
I2C RD IT66121: 0x0C : 0x006C0000
I2C WR IT66121: 0x0C : 0x106C0000
```
???
```
I2C RD IT66121: 0x70 : 0x10000801
I2C RD IT66121: 0x70 : 0x10000801
I2C WR IT66121: 0x70 : 0x10000801
```
0xC0: ???
```
I2C RD IT66121: 0xC0 : 0x089A8102
I2C WR IT66121: 0xC0 : 0x089A8100
```
???
```
I2C RD IT66121: 0x60 : 0x188810FF
I2C WR IT66121: 0x60 : 0x188810FF
```
0x62: set parameters for TDMS < 80MHz
```
I2C RD IT66121: 0x60 : 0x188810FF
I2C RD IT66121: 0x60 : 0x188810FF
I2C WR IT66121: 0x60 : 0x181810FF
```
0x64: set parameters for TDMS < 80MHz
```
I2C RD IT66121: 0x64 : 0x00000094
I2C RD IT66121: 0x64 : 0x00000094
I2C WR IT66121: 0x64 : 0x0000001D
```
0x68: set parameters for TDMS < 80MHz
```
I2C RD IT66121: 0x68 : 0xFF003000
I2C RD IT66121: 0x68 : 0xFF003000
I2C WR IT66121: 0x68 : 0xFF003010
```
0x04: clear SW Video base clock reset
```
I2C RD IT66121: 0x04 : 0x00006009
I2C RD IT66121: 0x04 : 0x00006009
I2C WR IT66121: 0x04 : 0x00006001
```
0x61: Disable reset for HDMI_TX_DRV
```
I2C RD IT66121: 0x60 : 0x181810FF
I2C WR IT66121: 0x60 : 0x181800FF
```
???
```
I2C RD IT66121: 0x04 : 0x00006001
I2C WR IT66121: 0x04 : 0x00006001
```
0x0F: Power Up TxCLK
```
I2C RD IT66121: 0x0C : 0x106C0000
I2C WR IT66121: 0x0C : 0x006C0000
```
???
```
I2C RD IT66121: 0x60 : 0x181800FF
I2C WR IT66121: 0x60 : 0x181800FF
```
0x0F: Power Down TxCLK
```
I2C RD IT66121: 0x0C : 0x006C0000
I2C WR IT66121: 0x0C : 0x016C0000
```
0x68: 00 -> 01 ???
```
I2C RD IT66121: 0x68 : 0x00000000
I2C WR IT66121: 0x68 : 0x00000001
```
???
```
I2C RD IT66121: 0x68 : 0x00000001
I2C RD IT66121: 0x68 : 0x00000001
I2C WR IT66121: 0x68 : 0x00000001
```
???
```
I2C RD IT66121: 0x68 : 0x00000001
I2C RD IT66121: 0x68 : 0x00000001
I2C WR IT66121: 0x68 : 0x00000001
```
???
```
I2C RD IT66121: 0x68 : 0x00000001
```
???
```
I2C RD IT66121: 0x6C : 0xFF7F7B00
I2C WR IT66121: 0x6C : 0xFF7F7B00
```
0x6D: 7B ->70 ???
```
I2C RD IT66121: 0x6C : 0xFF7F7B00
I2C RD IT66121: 0x6C : 0xFF7F7B00
I2C WR IT66121: 0x6C : 0xFF7F7000
```
0x0F: Power Up TxCLK
```
I2C RD IT66121: 0x0C : 0x016C0000
I2C WR IT66121: 0x0C : 0x006C0000
```
0xCE: Enable Audio InfoFrame, Repeat Audio InfoFrame
```
I2C RD IT66121: 0xCC : 0xFF0003FF
I2C WR IT66121: 0xCC : 0xFF0303FF
```
0x04: Audio FIFO reset, SW Audio base clock reset
```
I2C RD IT66121: 0x04 : 0x00006001
I2C RD IT66121: 0x04 : 0x00006001
I2C WR IT66121: 0x04 : 0x00006015
```
0x58: MCLK 01: 2x128Fs
```
I2C RD IT66121: 0x58 : 0xFE030311
I2C WR IT66121: 0x58 : 0xFE030315
```
???
```
I2C RD IT66121: 0x0C : 0x006C0000
I2C RD IT66121: 0x0C : 0x006C0000
I2C WR IT66121: 0x0C : 0x006C0000
```
???
```
I2C RD IT66121: 0xE0 : 0x00E441C0
I2C RD IT66121: 0xE0 : 0x00E441C0
I2C WR IT66121: 0xE0 : 0x00E441C0
```
???
```
I2C RD IT66121: 0xE4 : 0x00000000
```
0x0F: Power Down TxCLK
```
I2C RD IT66121: 0x0C : 0x006C0000
I2C WR IT66121: 0x0C : 0x016C0000
```
0x33: 80 -> 00
```
I2C RD IT66121: 0x30 : 0x80F3D8A7
I2C WR IT66121: 0x30 : 0x00F3D8A7
```
0x34: 18 -> 10
```
I2C RD IT66121: 0x34 : 0x00000018
I2C WR IT66121: 0x34 : 0x00000010
```
???
```
I2C RD IT66121: 0x34 : 0x00000010
I2C WR IT66121: 0x34 : 0x00000010
```
0x30: A7 -> 00 ???
```
I2C RD IT66121: 0x30 : 0x00F3D8A7
I2C WR IT66121: 0x30 : 0x00F3D800
```
0x31: D8 -> 00 ???
```
I2C RD IT66121: 0x30 : 0x00F3D800
I2C WR IT66121: 0x30 : 0x00F30000
```
0x32: F3 -> 00 ???
```
I2C RD IT66121: 0x30 : 0x00F30000
I2C WR IT66121: 0x30 : 0x00000000
```
0x0F: Power Up TxCLK
```
I2C RD IT66121: 0x0C : 0x016C0000
I2C WR IT66121: 0x0C : 0x006C0000
```
0xF8: 00 -> C3 ???
```
I2C RD IT66121: 0xF8 : 0xFFFFFF00
I2C WR IT66121: 0xF8 : 0xFFFFFFC3
```
0xF8: C3 -> A5 ???
```
I2C RD IT66121: 0xF8 : 0xFFFFFFC3
I2C WR IT66121: 0xF8 : 0xFFFFFFA5
```
???
```
I2C RD IT66121: 0xC4 : 0xFF0304C0
I2C RD IT66121: 0xC4 : 0xFF0304C0
I2C WR IT66121: 0xC4 : 0xFF0304C0
```
0xF8: A5 -> FF ???
```
I2C RD IT66121: 0xF8 : 0xFFFFFFA5
I2C WR IT66121: 0xF8 : 0xFFFFFFFF
```
0x0F: Power Down TxCLK
```
I2C RD IT66121: 0x0C : 0x006C0000
I2C WR IT66121: 0x0C : 0x016C0000
```
0x98: 00 -> 09 ???
```
I2C RD IT66121: 0x98 : 0xFFFF7800
I2C WR IT66121: 0x98 : 0xFFFF7809
```
0x99: F7 -> F6 ???
```
I2C RD IT66121: 0x98 : 0xFFFF7809
I2C RD IT66121: 0x98 : 0xFFFF7809
I2C WR IT66121: 0x98 : 0xFFFF6809
```
0x0F: Power Up TxCLK
```
I2C RD IT66121: 0x0C : 0x016C0000
I2C WR IT66121: 0x0C : 0x006C0000
```
0x04: clear Audio FIFO reset
```
I2C RD IT66121: 0x04 : 0x00006015
I2C RD IT66121: 0x04 : 0x00006015
I2C WR IT66121: 0x04 : 0x00006011
```
0x0F: Power Down TxCLK
```
I2C RD IT66121: 0x0C : 0x006C0000
I2C WR IT66121: 0x0C : 0x016C0000
```
0x90 - 0x93: ???
```
I2C WR IT66121: 0x90 : 0x02000000
```
0x94: 06 -> 00 ???
```
I2C RD IT66121: 0x94 : 0xFFFFFF06
I2C WR IT66121: 0x94 : 0xFFFFFF00
```
0x98 - 00x9B: ???
```
I2C WR IT66121: 0x98 : 0x00000000
```
0x0F: Power Up TxCLK
```
I2C RD IT66121: 0x0C : 0x016C0000
I2C WR IT66121: 0x0C : 0x006C0000
```
???
```
I2C RD IT66121: 0x0C : 0x006C0000
I2C WR IT66121: 0x0C : 0x006C0000
```
0xE0 - 0xE3: ???
```
I2C WR IT66121: 0xE0 : 0x00E44101
```
0xE4 - 0xE7: ???
```
I2C WR IT66121: 0xE4 : 0x00000000
```
0x09: Enable Audio overflow interrupt
```
I2C RD IT66121: 0x08 : 0xFFFFFF00
I2C RD IT66121: 0x08 : 0xFFFFFF00
I2C WR IT66121: 0x08 : 0xFFFF7F00
```
0x04: clear SW Audio base clock reset
```
I2C RD IT66121: 0x04 : 0x00006011
I2C RD IT66121: 0x04 : 0x00006011
I2C WR IT66121: 0x04 : 0x00006001
```
???
```
I2C RD IT66121: 0x0C : 0x006C0000
I2C WR IT66121: 0x0C : 0x006C0000
```
0xC1: disable AVMute
```
I2C RD IT66121: 0xC0 : 0x089A8100
I2C RD IT66121: 0xC0 : 0x089A8100
I2C WR IT66121: 0xC0 : 0x089A8000
```
???
```
I2C RD IT66121: 0xC4 : 0xFF0304C0
I2C WR IT66121: 0xC4 : 0xFF0304C0
```
**Strange sequence of NOT forcing "monitor connected" status**

*537 frames of 1152000 bytes each skipped*<br>
VGA_CTRL_REG_ACLK: Do not force VGA connect
```
REG RD 0x803C : 0xD701084D
REG WR 0x803C : 0xD501084D
```
*7 frames of 1152000 bytes each skipped*
```
INTERRUPT	1
REG RD 0x8000 : 0xA8087EE1
```
**Monitor disconnected**

*137 frames of 1152000 bytes each skipped*
```
INTERRUPT	1
REG RD 0x8000 : 0x480AA260
```
VGA_CTRL_REG_ACLK: VGA error interrupt disable
```
REG RD 0x803C : 0xD501084D
REG WR 0x803C : 0xD401084D
```
VGA_CTRL_REG_ACLK: allow hardware auto-control for PLL
```
REG RD 0x803C : 0xD401084D
REG WR 0x803C : 0xD001084D
```
**'Disable' sequence for USB interface**
```
REG RD 0x0078 : 0x18010D14
REG WR 0x0078 : 0x18030D14
```
```
REG RD 0x0070 : 0x04186085
REG WR 0x0070 : 0x04086085
```
```
REG RD 0x0070 : 0x04086085
REG WR 0x0070 : 0x04006085
```
